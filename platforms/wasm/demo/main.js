import {EngineUi} from './engine-ui.js';

const DEFAULT_STATE =
    'JTdCJTIydGVtcG9Kc29uJTIyJTNBMTIwJTJDJTIyZGVsYXlUaW1lSnNvbiUyMiUzQTAuNSUyQyUyMmRlbGF5RmVlZGJhY2tKc29uJTIyJTNBMC4yJTJDJTIyaW5zdHJ1bWVudHNKc29uJTIyJTNBJTVCJTdCJTIyaGFuZGxlJTIyJTNBMiUyQyUyMmNvbnRyb2xWYWx1ZXMlMjIlM0ElN0IlMjIwJTIyJTNBJTIyMC4yJTIyJTJDJTIyMSUyMiUzQSUyMjAlMjIlMkMlMjIyJTIyJTNBMCUyQyUyMjMlMjIlM0ElMjIwLjElMjIlMkMlMjI0JTIyJTNBJTIyOCUyMiUyQyUyMjUlMjIlM0ElMjIwLjA1JTIyJTJDJTIyNiUyMiUzQSUyMjAuMDUlMjIlMkMlMjI3JTIyJTNBJTIyMSUyMiUyQyUyMjglMjIlM0ElMjIwLjElMjIlMkMlMjI5JTIyJTNBJTIyMSUyMiUyQyUyMjEwJTIyJTNBJTIyMCUyMiUyQyUyMjExJTIyJTNBJTIyMCUyMiUyQyUyMjEyJTIyJTNBJTIyMCUyMiUyQyUyMjEzJTIyJTNBJTIyMC4xJTIyJTJDJTIyMTQlMjIlM0ElMjIwJTIyJTJDJTIyMTUlMjIlM0ElMjIwJTIyJTJDJTIyMTYlMjIlM0ElMjIxNiUyMiUyQyUyMjE3JTIyJTNBJTIyMSUyMiUyQyUyMjE4JTIyJTNBJTIyMC4yNSUyMiUyQyUyMjE5JTIyJTNBJTIyOCUyMiUyQyUyMjIwJTIyJTNBJTIyMCUyMiUyQyUyMjIxJTIyJTNBJTIyNDgwMDAlMjIlMkMlMjIyMiUyMiUzQSUyMjAuNjk0JTIyJTJDJTIyMjMlMjIlM0ElMjIwLjI1JTIyJTJDJTIyMjQlMjIlM0ElMjIwJTIyJTJDJTIyMjUlMjIlM0ElMjIwJTIyJTJDJTIyMjYlMjIlM0ElMjIwLjUlMjIlMkMlMjIyNyUyMiUzQSUyMjIlMjIlN0QlN0QlMkMlN0IlMjJoYW5kbGUlMjIlM0EzJTJDJTIyY29udHJvbFZhbHVlcyUyMiUzQSU3QiUyMjAlMjIlM0ElMjIwLjE1JTIyJTJDJTIyMSUyMiUzQSUyMjAlMjIlMkMlMjIyJTIyJTNBMCUyQyUyMjMlMjIlM0ElMjIwJTIyJTJDJTIyNCUyMiUzQSUyMjglMjIlMkMlMjI1JTIyJTNBJTIyMCUyMiUyQyUyMjYlMjIlM0ElMjIwJTIyJTJDJTIyNyUyMiUzQSUyMjElMjIlMkMlMjI4JTIyJTNBJTIyMC4wNSUyMiUyQyUyMjklMjIlM0ElMjIxJTIyJTJDJTIyMTAlMjIlM0ElMjIwJTIyJTJDJTIyMTElMjIlM0ElMjIxJTIyJTJDJTIyMTIlMjIlM0ElMjIwJTIyJTJDJTIyMTMlMjIlM0ElMjIwJTIyJTJDJTIyMTQlMjIlM0ElMjIwJTIyJTJDJTIyMTUlMjIlM0ElMjIwJTIyJTJDJTIyMTYlMjIlM0ElMjIxNiUyMiUyQyUyMjE3JTIyJTNBJTIyMSUyMiUyQyUyMjE4JTIyJTNBJTIyMC4yNSUyMiUyQyUyMjE5JTIyJTNBJTIyOCUyMiUyQyUyMjIwJTIyJTNBJTIyMiUyMiUyQyUyMjIxJTIyJTNBJTIyNDgwJTIyJTJDJTIyMjIlMjIlM0ElMjIwLjc5MyUyMiUyQyUyMjIzJTIyJTNBJTIyMC4xJTIyJTJDJTIyMjQlMjIlM0ElMjIwJTIyJTJDJTIyMjUlMjIlM0ElMjIzJTIyJTJDJTIyMjYlMjIlM0ElMjIwLjIlMjIlMkMlMjIyNyUyMiUzQSUyMjQlMjIlN0QlN0QlMkMlN0IlMjJoYW5kbGUlMjIlM0E0JTJDJTIyY29udHJvbFZhbHVlcyUyMiUzQSU3QiUyMjAlMjIlM0ElMjIwLjIlMjIlMkMlMjIxJTIyJTNBJTIyLTElMjIlMkMlMjIyJTIyJTNBMCUyQyUyMjMlMjIlM0ElMjItMC4xJTIyJTJDJTIyNCUyMiUzQSUyMjglMjIlMkMlMjI1JTIyJTNBJTIyMC4wNSUyMiUyQyUyMjYlMjIlM0ElMjIwLjA1JTIyJTJDJTIyNyUyMiUzQSUyMjElMjIlMkMlMjI4JTIyJTNBJTIyMC4xJTIyJTJDJTIyOSUyMiUzQSUyMjElMjIlMkMlMjIxMCUyMiUzQSUyMjAlMjIlMkMlMjIxMSUyMiUzQSUyMjAlMjIlMkMlMjIxMiUyMiUzQSUyMjAlMjIlMkMlMjIxMyUyMiUzQSUyMjAuNzUlMjIlMkMlMjIxNCUyMiUzQSUyMjAlMjIlMkMlMjIxNSUyMiUzQSUyMjAlMjIlMkMlMjIxNiUyMiUzQSUyMjE2JTIyJTJDJTIyMTclMjIlM0ElMjIxJTIyJTJDJTIyMTglMjIlM0ElMjIwJTIyJTJDJTIyMTklMjIlM0ElMjIxJTIyJTJDJTIyMjAlMjIlM0ElMjIwJTIyJTJDJTIyMjElMjIlM0ElMjI0ODAwMCUyMiUyQyUyMjIyJTIyJTNBJTIyMC42OTQlMjIlMkMlMjIyMyUyMiUzQSUyMjAuMSUyMiUyQyUyMjI0JTIyJTNBJTIyMCUyMiUyQyUyMjI1JTIyJTNBJTIyMCUyMiUyQyUyMjI2JTIyJTNBJTIyMC41JTIyJTJDJTIyMjclMjIlM0ElMjIyJTIyJTdEJTdEJTVEJTJDJTIycGVyZm9ybWVyc0pzb24lMjIlM0ElNUIlN0IlMjJpbnN0cnVtZW50SGFuZGxlJTIyJTNBJTIyMiUyMiUyQyUyMmxvb3BMZW5ndGglMjIlM0E0JTJDJTIybm90ZXMlMjIlM0ElNUIlN0IlMjJwb3NpdGlvbiUyMiUzQTAlMkMlMjJkdXJhdGlvbiUyMiUzQTAuNSUyQyUyMnBpdGNoJTIyJTNBMiUyQyUyMmdhaW4lMjIlM0ExJTdEJTJDJTdCJTIycG9zaXRpb24lMjIlM0ExLjI1JTJDJTIyZHVyYXRpb24lMjIlM0EwLjUlMkMlMjJwaXRjaCUyMiUzQTclMkMlMjJnYWluJTIyJTNBMSU3RCUyQyU3QiUyMnBvc2l0aW9uJTIyJTNBMiUyQyUyMmR1cmF0aW9uJTIyJTNBMC41JTJDJTIycGl0Y2glMjIlM0EwJTJDJTIyZ2FpbiUyMiUzQTElN0QlMkMlN0IlMjJwb3NpdGlvbiUyMiUzQTMuMjUlMkMlMjJkdXJhdGlvbiUyMiUzQTAuNzUlMkMlMjJwaXRjaCUyMiUzQTclMkMlMjJnYWluJTIyJTNBMSU3RCUyQyU3QiUyMnBvc2l0aW9uJTIyJTNBNCUyQyUyMmR1cmF0aW9uJTIyJTNBMC41JTJDJTIycGl0Y2glMjIlM0EyJTJDJTIyZ2FpbiUyMiUzQTElN0QlNUQlN0QlMkMlN0IlMjJpbnN0cnVtZW50SGFuZGxlJTIyJTNBJTIyMyUyMiUyQyUyMmxvb3BMZW5ndGglMjIlM0EyJTJDJTIybm90ZXMlMjIlM0ElNUIlN0IlMjJwb3NpdGlvbiUyMiUzQTAlMkMlMjJkdXJhdGlvbiUyMiUzQTAuNzUlMkMlMjJwaXRjaCUyMiUzQTIlMkMlMjJnYWluJTIyJTNBMSU3RCUyQyU3QiUyMnBvc2l0aW9uJTIyJTNBMS41JTJDJTIyZHVyYXRpb24lMjIlM0EwLjI1JTJDJTIycGl0Y2glMjIlM0EyJTJDJTIyZ2FpbiUyMiUzQTElN0QlNUQlN0QlMkMlN0IlMjJpbnN0cnVtZW50SGFuZGxlJTIyJTNBJTIyNCUyMiUyQyUyMmxvb3BMZW5ndGglMjIlM0E4JTJDJTIybm90ZXMlMjIlM0ElNUIlN0IlMjJwb3NpdGlvbiUyMiUzQTAlMkMlMjJkdXJhdGlvbiUyMiUzQTEuNSUyQyUyMnBpdGNoJTIyJTNBMiUyQyUyMmdhaW4lMjIlM0ExJTdEJTJDJTdCJTIycG9zaXRpb24lMjIlM0EyJTJDJTIyZHVyYXRpb24lMjIlM0ExJTJDJTIycGl0Y2glMjIlM0EwJTJDJTIyZ2FpbiUyMiUzQTElN0QlMkMlN0IlMjJwb3NpdGlvbiUyMiUzQTQlMkMlMjJkdXJhdGlvbiUyMiUzQTElMkMlMjJwaXRjaCUyMiUzQTclMkMlMjJnYWluJTIyJTNBMSU3RCUyQyU3QiUyMnBvc2l0aW9uJTIyJTNBNiUyQyUyMmR1cmF0aW9uJTIyJTNBMSUyQyUyMnBpdGNoJTIyJTNBOSUyQyUyMmdhaW4lMjIlM0ExJTdEJTJDJTdCJTIycG9zaXRpb24lMjIlM0E3LjUlMkMlMjJkdXJhdGlvbiUyMiUzQTAuNSUyQyUyMnBpdGNoJTIyJTNBNCUyQyUyMmdhaW4lMjIlM0ExJTdEJTVEJTdEJTVEJTdE';

/**
 * Initializes the barelymusician engine on page load.
 */
const onLoad = async () => {
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  await audioContext.audioWorklet.addModule('../src/processor.js');
  document.body.addEventListener('click', () => audioContext.resume());

  const engineContainer = document.createElement('div');
  engineContainer.className = 'engine';
  document.body.appendChild(engineContainer);

  new EngineUi({
    container: engineContainer,
    audioContext: audioContext,
    state: (location.hash ? location.hash.slice(1) : DEFAULT_STATE),
  });
};

window.addEventListener('load', onLoad);
