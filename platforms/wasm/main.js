import {Engine} from './engine.js';

const DEFAULT_STATE =
    'JTdCJTIydGVtcG9Kc29uJTIyJTNBMTI0JTJDJTIyZGVsYXlUaW1lSnNvbiUyMiUzQTAuNSUyQyUyMmRlbGF5RmVlZGJhY2tKc29uJTIyJTNBMC4yJTJDJTIyaW5zdHJ1bWVudHNKc29uJTIyJTNBJTVCJTdCJTIyaGFuZGxlJTIyJTNBJTIyNDI0OTc3NiUyMiUyQyUyMmNvbnRyb2xWYWx1ZXMlMjIlM0ElN0IlMjIwJTIyJTNBJTIyMC4yNSUyMiUyQyUyMjElMjIlM0ElMjIwJTIyJTJDJTIyMyUyMiUzQSUyMjAuMSUyMiUyQyUyMjUlMjIlM0ElMjIwLjA1JTIyJTJDJTIyNiUyMiUzQSUyMjAuMDUlMjIlMkMlMjI3JTIyJTNBJTIyMSUyMiUyQyUyMjglMjIlM0ElMjIwLjA1JTIyJTJDJTIyOSUyMiUzQSUyMjElMjIlMkMlMjIxMCUyMiUzQSUyMjAlMjIlMkMlMjIxMSUyMiUzQSUyMjAlMjIlMkMlMjIxMiUyMiUzQSUyMjAlMjIlMkMlMjIxMyUyMiUzQSUyMjAuMjUlMjIlMkMlMjIxNCUyMiUzQSUyMjAlMjIlMkMlMjIxNSUyMiUzQSUyMjAlMjIlMkMlMjIxNiUyMiUzQSUyMjE2JTIyJTJDJTIyMTclMjIlM0ElMjIxJTIyJTJDJTIyMTglMjIlM0ElMjIwJTIyJTJDJTIyMTklMjIlM0ElMjI4JTIyJTJDJTIyMjAlMjIlM0ElMjIwJTIyJTJDJTIyMjElMjIlM0ElMjI0ODAwMCUyMiUyQyUyMjIyJTIyJTNBJTIyMC42OTQlMjIlMkMlMjIyMyUyMiUzQSUyMjAuMiUyMiUyQyUyMjI1JTIyJTNBJTIyMCUyMiUyQyUyMjI2JTIyJTNBJTIyMC41JTIyJTJDJTIyMjclMjIlM0ElMjIyJTIyJTdEJTdEJTJDJTdCJTIyaGFuZGxlJTIyJTNBJTIyNDI1NDU5MiUyMiUyQyUyMmNvbnRyb2xWYWx1ZXMlMjIlM0ElN0IlMjIwJTIyJTNBJTIyMC4yJTIyJTJDJTIyMSUyMiUzQSUyMjAlMjIlMkMlMjIzJTIyJTNBJTIyLTAuMSUyMiUyQyUyMjUlMjIlM0ElMjIwLjE1JTIyJTJDJTIyNiUyMiUzQSUyMjAlMjIlMkMlMjI3JTIyJTNBJTIyMSUyMiUyQyUyMjglMjIlM0ElMjIwLjA1JTIyJTJDJTIyOSUyMiUzQSUyMjElMjIlMkMlMjIxMCUyMiUzQSUyMjAlMjIlMkMlMjIxMSUyMiUzQSUyMjElMjIlMkMlMjIxMiUyMiUzQSUyMjAlMjIlMkMlMjIxMyUyMiUzQSUyMjAlMjIlMkMlMjIxNCUyMiUzQSUyMjAlMjIlMkMlMjIxNSUyMiUzQSUyMjAlMjIlMkMlMjIxNiUyMiUzQSUyMjE2JTIyJTJDJTIyMTclMjIlM0ElMjIxJTIyJTJDJTIyMTglMjIlM0ElMjIwJTIyJTJDJTIyMTklMjIlM0ElMjIyJTIyJTJDJTIyMjAlMjIlM0ElMjIyJTIyJTJDJTIyMjElMjIlM0ElMjI0ODAlMjIlMkMlMjIyMiUyMiUzQSUyMjAuNjk0JTIyJTJDJTIyMjMlMjIlM0ElMjIwLjElMjIlMkMlMjIyNSUyMiUzQSUyMjAlMjIlMkMlMjIyNiUyMiUzQSUyMjAuNSUyMiUyQyUyMjI3JTIyJTNBJTIyMiUyMiU3RCU3RCUyQyU3QiUyMmhhbmRsZSUyMiUzQSUyMjQyNTgxNjAlMjIlMkMlMjJjb250cm9sVmFsdWVzJTIyJTNBJTdCJTIyMCUyMiUzQSUyMjAuMjUlMjIlMkMlMjIxJTIyJTNBJTIyLTIlMjIlMkMlMjIzJTIyJTNBJTIyMCUyMiUyQyUyMjUlMjIlM0ElMjIwLjA1JTIyJTJDJTIyNiUyMiUzQSUyMjAuMSUyMiUyQyUyMjclMjIlM0ElMjIwLjc1JTIyJTJDJTIyOCUyMiUzQSUyMjAuMSUyMiUyQyUyMjklMjIlM0ElMjIxJTIyJTJDJTIyMTAlMjIlM0ElMjIwJTIyJTJDJTIyMTElMjIlM0ElMjIwJTIyJTJDJTIyMTIlMjIlM0ElMjIwJTIyJTJDJTIyMTMlMjIlM0ElMjIwLjklMjIlMkMlMjIxNCUyMiUzQSUyMjAlMjIlMkMlMjIxNSUyMiUzQSUyMjAlMjIlMkMlMjIxNiUyMiUzQSUyMjE2JTIyJTJDJTIyMTclMjIlM0ElMjIxJTIyJTJDJTIyMTglMjIlM0ElMjIwLjElMjIlMkMlMjIxOSUyMiUzQSUyMjIlMjIlMkMlMjIyMCUyMiUzQSUyMjAlMjIlMkMlMjIyMSUyMiUzQSUyMjQ4MDAwJTIyJTJDJTIyMjIlMjIlM0ElMjIwLjY5NCUyMiUyQyUyMjIzJTIyJTNBJTIyMC4xJTIyJTJDJTIyMjUlMjIlM0ElMjIzJTIyJTJDJTIyMjYlMjIlM0ElMjIwLjUlMjIlMkMlMjIyNyUyMiUzQSUyMjIlMjIlN0QlN0QlNUQlMkMlMjJwZXJmb3JtZXJzSnNvbiUyMiUzQSU1QiU3QiUyMmluc3RydW1lbnRIYW5kbGUlMjIlM0ElMjI0MjU0NTkyJTIyJTJDJTIybG9vcExlbmd0aCUyMiUzQTIlMkMlMjJub3RlcyUyMiUzQSU1QiU3QiUyMnBvc2l0aW9uJTIyJTNBMSUyQyUyMmR1cmF0aW9uJTIyJTNBMC4yNSUyQyUyMnBpdGNoJTIyJTNBMCUyQyUyMmdhaW4lMjIlM0ExJTdEJTVEJTdEJTJDJTdCJTIyaW5zdHJ1bWVudEhhbmRsZSUyMiUzQSUyMjQyNDk3NzYlMjIlMkMlMjJsb29wTGVuZ3RoJTIyJTNBOCUyQyUyMm5vdGVzJTIyJTNBJTVCJTdCJTIycG9zaXRpb24lMjIlM0EwJTJDJTIyZHVyYXRpb24lMjIlM0ExJTJDJTIycGl0Y2glMjIlM0EwJTJDJTIyZ2FpbiUyMiUzQTElN0QlMkMlN0IlMjJwb3NpdGlvbiUyMiUzQTIlMkMlMjJkdXJhdGlvbiUyMiUzQTElMkMlMjJwaXRjaCUyMiUzQTQlMkMlMjJnYWluJTIyJTNBMSU3RCUyQyU3QiUyMnBvc2l0aW9uJTIyJTNBMyUyQyUyMmR1cmF0aW9uJTIyJTNBMSUyQyUyMnBpdGNoJTIyJTNBNyUyQyUyMmdhaW4lMjIlM0ExJTdEJTJDJTdCJTIycG9zaXRpb24lMjIlM0E1JTJDJTIyZHVyYXRpb24lMjIlM0ExJTJDJTIycGl0Y2glMjIlM0E5JTJDJTIyZ2FpbiUyMiUzQTElN0QlMkMlN0IlMjJwb3NpdGlvbiUyMiUzQTUlMkMlMjJkdXJhdGlvbiUyMiUzQTElMkMlMjJwaXRjaCUyMiUzQTUlMkMlMjJnYWluJTIyJTNBMSU3RCUyQyU3QiUyMnBvc2l0aW9uJTIyJTNBNyUyQyUyMmR1cmF0aW9uJTIyJTNBMSUyQyUyMnBpdGNoJTIyJTNBNyUyQyUyMmdhaW4lMjIlM0ExJTdEJTJDJTdCJTIycG9zaXRpb24lMjIlM0E3JTJDJTIyZHVyYXRpb24lMjIlM0ExJTJDJTIycGl0Y2glMjIlM0E0JTJDJTIyZ2FpbiUyMiUzQTElN0QlNUQlN0QlMkMlN0IlMjJpbnN0cnVtZW50SGFuZGxlJTIyJTNBJTIyNDI1ODE2MCUyMiUyQyUyMmxvb3BMZW5ndGglMjIlM0ExNiUyQyUyMm5vdGVzJTIyJTNBJTVCJTdCJTIycG9zaXRpb24lMjIlM0ExJTJDJTIyZHVyYXRpb24lMjIlM0ExJTJDJTIycGl0Y2glMjIlM0ExMiUyQyUyMmdhaW4lMjIlM0ExJTdEJTJDJTdCJTIycG9zaXRpb24lMjIlM0ExNCUyQyUyMmR1cmF0aW9uJTIyJTNBMiUyQyUyMnBpdGNoJTIyJTNBMTIlMkMlMjJnYWluJTIyJTNBMSU3RCUyQyU3QiUyMnBvc2l0aW9uJTIyJTNBNCUyQyUyMmR1cmF0aW9uJTIyJTNBMSUyQyUyMnBpdGNoJTIyJTNBMTIlMkMlMjJnYWluJTIyJTNBMSU3RCUyQyU3QiUyMnBvc2l0aW9uJTIyJTNBNiUyQyUyMmR1cmF0aW9uJTIyJTNBMSUyQyUyMnBpdGNoJTIyJTNBOSUyQyUyMmdhaW4lMjIlM0ExJTdEJTJDJTdCJTIycG9zaXRpb24lMjIlM0E5JTJDJTIyZHVyYXRpb24lMjIlM0ExJTJDJTIycGl0Y2glMjIlM0E3JTJDJTIyZ2FpbiUyMiUzQTElN0QlMkMlN0IlMjJwb3NpdGlvbiUyMiUzQTEyJTJDJTIyZHVyYXRpb24lMjIlM0ExJTJDJTIycGl0Y2glMjIlM0E1JTJDJTIyZ2FpbiUyMiUzQTElN0QlMkMlN0IlMjJwb3NpdGlvbiUyMiUzQTEwJTJDJTIyZHVyYXRpb24lMjIlM0ExJTJDJTIycGl0Y2glMjIlM0E0JTJDJTIyZ2FpbiUyMiUzQTElN0QlMkMlN0IlMjJwb3NpdGlvbiUyMiUzQTE0JTJDJTIyZHVyYXRpb24lMjIlM0EyJTJDJTIycGl0Y2glMjIlM0EwJTJDJTIyZ2FpbiUyMiUzQTElN0QlNUQlN0QlNUQlN0Q';

/**
 * Initializes the barelymusician engine on page load.
 */
const onLoad = async () => {
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  await audioContext.audioWorklet.addModule('processor.js');
  document.body.addEventListener('click', () => audioContext.resume());

  const engineContainer = document.createElement('div');
  engineContainer.className = 'engine';
  document.body.appendChild(engineContainer);

  new Engine({
    container: engineContainer,
    audioContext: audioContext,
    state: (location.hash ? location.hash.slice(1) : DEFAULT_STATE),
  });
};

window.addEventListener('load', onLoad);
