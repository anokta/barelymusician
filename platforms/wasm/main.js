import {Engine} from './engine.js';

const DEFAULT_STATE =
    'JTdCJTIydGVtcG9Kc29uJTIyJTNBMTIwJTJDJTIyZGVsYXlUaW1lSnNvbiUyMiUzQTAuNSUyQyUyMmRlbGF5RmVlZGJhY2tKc29uJTIyJTNBMC4xJTJDJTIyaW5zdHJ1bWVudHNKc29uJTIyJTNBJTVCJTdCJTIyaGFuZGxlJTIyJTNBJTIyNDE4NjY1NiUyMiUyQyUyMmNvbnRyb2xWYWx1ZXMlMjIlM0ElN0IlMjIwJTIyJTNBJTIyMC4yNSUyMiUyQyUyMjElMjIlM0ElMjIwJTIyJTJDJTIyMyUyMiUzQSUyMjAlMjIlMkMlMjI1JTIyJTNBJTIyMC4xJTIyJTJDJTIyNiUyMiUzQSUyMjAuMSUyMiUyQyUyMjclMjIlM0ElMjIxJTIyJTJDJTIyOCUyMiUzQSUyMjAuMiUyMiUyQyUyMjExJTIyJTNBJTIyMCUyMiUyQyUyMjEzJTIyJTNBJTIyMC40OSUyMiUyQyUyMjE0JTIyJTNBJTIyMC4yJTIyJTJDJTIyMTYlMjIlM0ElMjIwJTIyJTJDJTIyMTclMjIlM0ElMjI0ODAwMCUyMiUyQyUyMjE4JTIyJTNBJTIyMC42OTQlMjIlMkMlMjIxOSUyMiUzQSUyMjE2JTIyJTJDJTIyMjAlMjIlM0ElMjIxJTIyJTJDJTIyMjElMjIlM0ElMjIwJTIyJTJDJTIyMjIlMjIlM0ElMjIwJTIyJTJDJTIyMjMlMjIlM0ElMjIwLjUlMjIlMkMlMjIyNCUyMiUzQSUyMjElMjIlN0QlN0QlMkMlN0IlMjJoYW5kbGUlMjIlM0ElMjI0MTkwMDE2JTIyJTJDJTIyY29udHJvbFZhbHVlcyUyMiUzQSU3QiUyMjAlMjIlM0ElMjIwLjE4JTIyJTJDJTIyMSUyMiUzQSUyMjAlMjIlMkMlMjIzJTIyJTNBJTIyMCUyMiUyQyUyMjUlMjIlM0ElMjIwLjIlMjIlMkMlMjI2JTIyJTNBJTIyMC4xJTIyJTJDJTIyNyUyMiUzQSUyMjElMjIlMkMlMjI4JTIyJTNBJTIyMC4yJTIyJTJDJTIyMTElMjIlM0ElMjIwLjg1JTIyJTJDJTIyMTMlMjIlM0ElMjIxJTIyJTJDJTIyMTQlMjIlM0ElMjIwJTIyJTJDJTIyMTYlMjIlM0ElMjIwJTIyJTJDJTIyMTclMjIlM0ElMjI0ODAwMCUyMiUyQyUyMjE4JTIyJTNBJTIyMC42OTQlMjIlMkMlMjIxOSUyMiUzQSUyMjE2JTIyJTJDJTIyMjAlMjIlM0ElMjIwLjc1JTIyJTJDJTIyMjElMjIlM0ElMjIwJTIyJTJDJTIyMjIlMjIlM0ElMjIwJTIyJTJDJTIyMjMlMjIlM0ElMjIwLjUlMjIlMkMlMjIyNCUyMiUzQSUyMjElMjIlN0QlN0QlNUQlMkMlMjJwZXJmb3JtZXJzSnNvbiUyMiUzQSU1QiU3QiUyMmluc3RydW1lbnRIYW5kbGUlMjIlM0ElMjI0MTg2NjU2JTIyJTJDJTIybG9vcExlbmd0aCUyMiUzQTglMkMlMjJub3RlcyUyMiUzQSU1QiU3QiUyMnBvc2l0aW9uJTIyJTNBMCUyQyUyMmR1cmF0aW9uJTIyJTNBMSUyQyUyMnBpdGNoJTIyJTNBMCUyQyUyMmdhaW4lMjIlM0ExJTdEJTJDJTdCJTIycG9zaXRpb24lMjIlM0ExJTJDJTIyZHVyYXRpb24lMjIlM0ExJTJDJTIycGl0Y2glMjIlM0E0JTJDJTIyZ2FpbiUyMiUzQTElN0QlMkMlN0IlMjJwb3NpdGlvbiUyMiUzQTIlMkMlMjJkdXJhdGlvbiUyMiUzQTElMkMlMjJwaXRjaCUyMiUzQTclMkMlMjJnYWluJTIyJTNBMSU3RCUyQyU3QiUyMnBvc2l0aW9uJTIyJTNBMyUyQyUyMmR1cmF0aW9uJTIyJTNBMSUyQyUyMnBpdGNoJTIyJTNBMTIlMkMlMjJnYWluJTIyJTNBMSU3RCUyQyU3QiUyMnBvc2l0aW9uJTIyJTNBNCUyQyUyMmR1cmF0aW9uJTIyJTNBMSUyQyUyMnBpdGNoJTIyJTNBNyUyQyUyMmdhaW4lMjIlM0ExJTdEJTJDJTdCJTIycG9zaXRpb24lMjIlM0E1JTJDJTIyZHVyYXRpb24lMjIlM0ExJTJDJTIycGl0Y2glMjIlM0E5JTJDJTIyZ2FpbiUyMiUzQTElN0QlMkMlN0IlMjJwb3NpdGlvbiUyMiUzQTYlMkMlMjJkdXJhdGlvbiUyMiUzQTElMkMlMjJwaXRjaCUyMiUzQTUlMkMlMjJnYWluJTIyJTNBMSU3RCUyQyU3QiUyMnBvc2l0aW9uJTIyJTNBNyUyQyUyMmR1cmF0aW9uJTIyJTNBMSUyQyUyMnBpdGNoJTIyJTNBMiUyQyUyMmdhaW4lMjIlM0ExJTdEJTJDJTdCJTIycG9zaXRpb24lMjIlM0E3JTJDJTIyZHVyYXRpb24lMjIlM0ExJTJDJTIycGl0Y2glMjIlM0E3JTJDJTIyZ2FpbiUyMiUzQTElN0QlNUQlN0QlMkMlN0IlMjJpbnN0cnVtZW50SGFuZGxlJTIyJTNBJTIyNDE5MDAxNiUyMiUyQyUyMmxvb3BMZW5ndGglMjIlM0EyJTJDJTIybm90ZXMlMjIlM0ElNUIlN0IlMjJwb3NpdGlvbiUyMiUzQTAlMkMlMjJkdXJhdGlvbiUyMiUzQTAuMTI1JTJDJTIycGl0Y2glMjIlM0EwJTJDJTIyZ2FpbiUyMiUzQTElN0QlMkMlN0IlMjJwb3NpdGlvbiUyMiUzQTElMkMlMjJkdXJhdGlvbiUyMiUzQTAuMTI1JTJDJTIycGl0Y2glMjIlM0EwJTJDJTIyZ2FpbiUyMiUzQTElN0QlNUQlN0QlNUQlN0Q=';

/**
 * Initializes the barelymusician engine on page load.
 */
const onLoad = async () => {
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  await audioContext.audioWorklet.addModule('processor.js');
  document.body.addEventListener('click', () => audioContext.resume());

  const engineContainer = document.createElement('div');
  engineContainer.className = 'engine';
  document.body.appendChild(engineContainer);

  new Engine({
    container: engineContainer,
    audioContext: audioContext,
    state: (location.hash ? location.hash.slice(1) : DEFAULT_STATE),
  });
};

window.addEventListener('load', onLoad);
